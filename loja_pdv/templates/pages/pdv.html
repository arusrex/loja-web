{% extends "base/base.html" %}
{% block content %}
    <div class="main-content">
        <h1>Ponto de Venda</h1>
        
        <!-- Venda -->
        <div class="table div-venda">
            <div class="my-1">
                <h2>Venda Nº: {{venda.id}} - Status: {% if venda.finalizada == False %}Em aberto{% else %}Finalizada{% endif %}</h2>
            </div>
            <div>
                {% if venda.cliente %}
                <h2>Cliente: <small>{{venda.cliente}}</small></h2>
                <button id="btn-clientes" class="btn my-1">Alterar Cliente</button>
                {% else %}
                <button id="btn-clientes" class="btn my-1">Adicionar Cliente</button>
                {% endif %}
            </div>

            <div class="table-clientes" style="display: none;">
                <h3 class="p-1">Todos Clientes</h3>
                <table id="dataTableClientes" class="display compact">
                    <thead>
                        <tr>
                            <th>Código</th>
                            <th>Nome</th>
                            <th>Ações</th>    
                        </tr>
                    </thead>
                    <tbody>
                        {% for cliente in clientes %}
                        <tr>
                            <td>{{cliente.codigo}}</td>
                            <td>{{cliente.nome}}</td>
                            <td>
                                {% if venda.cliente %}
                                <a class="btn" href="{% url "vendas:alterar_cliente" cliente.id %}">Alterar</a>
                                {% else %}
                                <a class="btn" href="{% url "vendas:adicionar_cliente" cliente.id %}">Adicionar</a>
                                {% endif %}
                            </td>
                        </tr>
                        {% endfor %}
                    </tbody>
                </table>
            </div>

            <table id="tableVenda" class="table-venda">
                <thead>
                    <tr>
                        <th>Código</th>
                        <th>EAN</th>
                        <th>Nome</th>
                        <th>Preço</th>
                        <th>Quantidade</th>
                        <th>Subtotal</th>
                        <th>Ações</th>
                    </tr>
                </thead>
                <tbody>
                    {% for item in venda.itens.all %}
                    <tr>
                        <td>{{ item.produto.codigo }}</td>
                        <td>{{ item.produto.ean }}</td>
                        <td>{{ item.produto.nome }}</td>
                        <td>{{ item.produto.preco }}</td>
                        <td>{{ item.quantidade }}</td>
                        <td>{{ item.subtotal}}</td>
                        <td><a class="btn" href="{% url "vendas:remover" item.id %}">Remover</td>
                    </tr>
                    {% endfor %}
                </tbody>
            </table>
            <div class="my-4">
                <small>Desconto total: {{venda.desconto_total}}</small>
                <h2>Total: {{venda.total}}</h2>
            </div>
        </div>

        <!-- Adicionar produtos -->
        <div class="table">
            <table id="dataTableProdutos" class="display compact cell-border">
                <h3 class="p-1">Todos Produtos</h3>
                <thead>
                    <tr>
                        <th>Código</th>
                        <th>EAN</th>
                        <th>Nome</th>
                        <th>Preço</th>
                        <th>Quantidade</th>
                    </tr>
                </thead>
                <tbody>
                    {% for produto in produtos %}
                    <tr>
                        <td>{{ produto.codigo }}</td>
                        <td>{{ produto.ean }}</td>
                        <td>{{ produto.nome }}</td>
                        <td>{{ produto.preco }}</td>
                        <td>
                            <form method="POST" action="{% url 'vendas:adicionar' produto.id %}">
                                {% csrf_token %}
                                <input type="number" id="quantidade" name="quantidade" min="1" value="1"></input>
                                <button class="btn">Adicionar</button>
                            </form>
                        </td>
                    </tr>
                    {% endfor %}
                </tbody>
            </table>
        </div>
    </div>
    <script>
        let btnCliente = document.getElementById('btn-clientes').addEventListener('click', () => {
            const tableClientes = document.querySelector('.table-clientes');
            if (tableClientes.style.display === 'none') {
                tableClientes.style.display = 'block';
            } else {
                tableClientes.style.display = 'none';
            }
        });
    </script>
{% endblock content %}